---
// TIL: weird that because of default exports, you haveto rename things that may conflict with your implicit module name
import ParentLayout from '#layouts/Layout.astro'
import Prose from '#components/prose.astro'
import * as GUIDE_STEPS from '#content/guide_steps/_guide_steps'

let {params} = Astro

let guide_steps = await GUIDE_STEPS.getCollection((entry) =>
	entry.slug.includes(
		`${params.guide_topic}/${params.guide_scope}`
	)
)

function hoistIndex(collection: GUIDE_STEPS.CollectionEntry[]) {
	let isIndexFile = (filename: string) =>
		filename.endsWith('index.md')

	let head = collection.find(({id}) => isIndexFile(id))
	let tail = collection.filter(({id}) => !isIndexFile(id))

	return [head, ...tail]
}

let entries = hoistIndex(guide_steps)
---

<ParentLayout>
	<Prose as="div" class="grid grid-cols-3 gap-8">
		<main class="col-span-2">
			<slot />
		</main>
		<nav>
			<ul>
				{
					entries.map((entry) => (
						<li>
							<a href={`/${entry.slug}`}>{entry.data.title}</a>
						</li>
					))
				}
			</ul>
		</nav>
	</Prose>
</ParentLayout>
